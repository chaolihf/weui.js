/*
* Tencent is pleased to support the open source community by making WeUI.js available.
* 
* Copyright (C) 2017 THL A29 Limited, a Tencent company. All rights reserved.
* 
* Licensed under the MIT License (the "License"); you may not use this file except in compliance
* with the License. You may obtain a copy of the License at
* 
*       http://opensource.org/licenses/MIT
* 
* Unless required by applicable law or agreed to in writing, software distributed under the License is
* distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
* either express or implied. See the License for the specific language governing permissions and
* limitations under the License.
*/

import $ from '../util/util';
import tpl from './gallery.html';

let _sington;

/**
 * gallery 带删除按钮的图片预览，主要是配合图片上传使用
 * @param {string} url gallery显示的图片的url
 * @param {object=} options 配置项
 * @param {string=} options.className 自定义类名
 * @param {function=} options.onDelete 点击删除图片时的回调
 * @param {boolean=} options.withoutPreview 没有预览图片
 * 
 *
 * @example
 * var gallery = weui.gallery(url, {
 *     className: 'custom-classname',
 *     onDelete: function(){
 *         if(confirm('确定删除该图片？')){ console.log('删除'); }
 *         gallery.hide(function() {
 *              console.log('`gallery` has been hidden');
 *          });
 *     }
 * });
 */
function gallery(url, options = {}) {
    if(_sington) return _sington;

    options = $.extend({
        className: '',
        onDelete: $.noop,
        withoutPreview:false
    }, options);

    const $gallery = $($.render(tpl, $.extend({
        downloadUrl: url,imageUrl: options.withoutPreview?"data:image/png;base64,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":url
    }, options)));

    function _hide(callback){
        _hide = $.noop; // 防止二次调用导致报错

        $gallery
            .addClass('weui-animate-fade-out')
            .on('animationend webkitAnimationEnd', function () {
                $gallery.remove();
                _sington = false;
                callback && callback();
            });
    }
    function hide(callback){ _hide(callback); }

    $('body').append($gallery);
    $gallery.find('.weui-gallery__img').on('click', function () { hide(); });
    $gallery.find('.ahui-gallery__download1').on('click', function () {
        options.onDelete.call(this, url);
    });

    $gallery.show().addClass('weui-animate-fade-in');

    _sington = $gallery[0];
    _sington.hide = hide;
    return _sington;
}
export default gallery;
